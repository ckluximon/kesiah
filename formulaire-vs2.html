<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire R√©union √âquipe VS2 - Solerys</title>
    <meta name="description" content="Formulaire pour organiser les r√©unions d'√©quipe VS2 et g√©n√©rer automatiquement les comptes-rendus">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 50%, #58d68d 100%);
            color: white;
            padding: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(180deg); }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .website {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: #27ae60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .company {
            font-size: 18px;
            font-weight: 600;
        }

        .header-right {
            text-align: right;
        }

        .meeting-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .meeting-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .header-right {
                text-align: center;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e8ecef;
            border-radius: 10px;
            background: #fafbfc;
        }

        .section h3 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e8ecef;
            transition: background-color 0.2s;
        }

        .checkbox-item:hover {
            background: #f8f9fa;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #3498db, #5dade2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .ordre-jour-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: move;
            transition: all 0.2s;
        }

        .ordre-jour-item input[type="text"] {
            font-size: 16px;
            padding: 12px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .ordre-jour-item textarea {
            font-size: 14px;
            padding: 12px;
            min-height: 80px;
            resize: vertical;
        }

        .ordre-jour-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ordre-jour-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .delete-item {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            float: right;
            font-size: 12px;
        }

        .char-counter {
            font-size: 12px;
            color: #7f8c8d;
            text-align: right;
            margin-top: 5px;
        }

        .char-counter.warning {
            color: #e67e22;
        }

        .char-counter.danger {
            color: #e74c3c;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .pdf-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
        }

        .pdf-content {
            background: white;
            margin: 20px;
            height: calc(100vh - 40px);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }

        .pdf-header {
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .save-status.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .form-container {
                padding: 20px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="website">www.solerys.fr</div>
                <div class="logo-section">
                    <div class="logo">S</div>
                    <div class="company">OASYS & Cie</div>
                </div>
            </div>
            <div class="header-right">
                <div class="meeting-title">R√©union d'√©quipe VS2</div>
                <div class="meeting-subtitle">Partages des Pratiques Professionnelles</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="form-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <form id="reunionForm">
                <!-- Informations g√©n√©rales -->
                <div class="section">
                    <h3>üìã Informations g√©n√©rales</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reference">R√©f√©rence :</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="reference" name="reference" value="16166/VS25/" placeholder="Ex: 16166/VS25/0612" style="flex: 1;">
                                <button type="button" class="btn btn-secondary" onclick="ajouterDateReference()" style="padding: 8px 12px; font-size: 12px;">üìÖ + Date</button>
                            </div>
                            <div style="font-size: 11px; color: #666; margin-top: 3px;">Format sugg√©r√©: XXXXX/VS25/JJMM (cliquez "üìÖ + Date" pour ajouter la date automatiquement)</div>
                        </div>
                        <div class="form-group">
                            <label for="date">Date :</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Horaires :</label>
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr auto; gap: 10px; align-items: center;">
                                <div>
                                    <label for="heureDebut" style="font-size: 12px; margin-bottom: 3px;">D√©but :</label>
                                    <input type="time" id="heureDebut" name="heureDebut" value="14:00" required onchange="updateHoraires()">
                                </div>
                                <span style="margin-top: 20px;">√†</span>
                                <div>
                                    <label for="heureFin" style="font-size: 12px; margin-bottom: 3px;">Fin :</label>
                                    <input type="time" id="heureFin" name="heureFin" value="16:00" required onchange="updateHoraires()">
                                </div>
                                <div style="margin-top: 20px; font-size: 12px; color: #666;" id="dureeAffichage">(2h)</div>
                            </div>
                            <input type="hidden" id="horaires" name="horaires" value="14h00 √† 16h00">
                        </div>
                        <div class="form-group">
                            <label for="animateur">Animateur :</label>
                            <input type="text" id="animateur" name="animateur" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="modalite">Modalit√© :</label>
                            <select id="modalite" name="modalite" required>
                                <option value="">Choisir la modalit√©</option>
                                <option value="Pr√©sentiel">Pr√©sentiel</option>
                                <option value="Distanciel">Distanciel</option>
                                <option value="Hybride">Hybride</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sites concern√©s -->
                <div class="section">
                    <h3>üè¢ Sites concern√©s</h3>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" id="site1" name="sites" value="Strasbourg">
                            <label for="site1">Strasbourg</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site2" name="sites" value="Haguenau">
                            <label for="site2">Haguenau</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site3" name="sites" value="Molsheim">
                            <label for="site3">Molsheim</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site4" name="sites" value="Saverne">
                            <label for="site4">Saverne</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site5" name="sites" value="S√©lestat">
                            <label for="site5">S√©lestat</label>
                        </div>
                    </div>
                </div>

                <!-- Participants -->
                <div class="section">
                    <h3>üë• Participants</h3>
                    
                    <h4 style="color: #27ae60; margin-bottom: 10px;">Consultants pr√©sents :</h4>
                    <div class="checkbox-grid" id="consultantsPresents">
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons1" name="consultants" value="Alicia DOUAIR" onchange="updateAbsents()">
                            <label for="cons1">Alicia DOUAIR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons2" name="consultants" value="Nathalie TRILLO" onchange="updateAbsents()">
                            <label for="cons2">Nathalie TRILLO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons3" name="consultants" value="Elodie ANTOINE" onchange="updateAbsents()">
                            <label for="cons3">Elodie ANTOINE</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons4" name="consultants" value="Caroline BRACONNIER" onchange="updateAbsents()">
                            <label for="cons4">Caroline BRACONNIER</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons5" name="consultants" value="Farida BENZIADA" onchange="updateAbsents()">
                            <label for="cons5">Farida BENZIADA</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons6" name="consultants" value="Michele BENEDICTO" onchange="updateAbsents()">
                            <label for="cons6">Michele BENEDICTO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons7" name="consultants" value="Chitrasen LUXIMON" onchange="updateAbsents()">
                            <label for="cons7">Chitrasen LUXIMON</label>
                        </div>
                    </div>
                    
                    <h4 style="color: #e74c3c; margin: 20px 0 10px 0;">Consultants absents :</h4>
                    <div class="checkbox-grid" id="consultantsAbsents">
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs1" name="absents" value="Alicia DOUAIR" checked onchange="updatePresents()">
                            <label for="abs1">Alicia DOUAIR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs2" name="absents" value="Nathalie TRILLO" checked onchange="updatePresents()">
                            <label for="abs2">Nathalie TRILLO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs3" name="absents" value="Elodie ANTOINE" checked onchange="updatePresents()">
                            <label for="abs3">Elodie ANTOINE</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs4" name="absents" value="Caroline BRACONNIER" checked onchange="updatePresents()">
                            <label for="abs4">Caroline BRACONNIER</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs5" name="absents" value="Farida BENZIADA" checked onchange="updatePresents()">
                            <label for="abs5">Farida BENZIADA</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs6" name="absents" value="Michele BENEDICTO" checked onchange="updatePresents()">
                            <label for="abs6">Michele BENEDICTO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs7" name="absents" value="Chitrasen LUXIMON" checked onchange="updatePresents()">
                            <label for="abs7">Chitrasen LUXIMON</label>
                        </div>
                    </div>
                </div>

                <!-- Intervenants -->
                <div class="section">
                    <h3>üéØ Intervenants</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="intervenantsSolerys">Intervenants Solerys :</label>
                            <textarea id="intervenantsSolerys" name="intervenantsSolerys" rows="2" placeholder="Nom, fonction..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="intervenantsExterieurs">Intervenants ext√©rieurs :</label>
                            <textarea id="intervenantsExterieurs" name="intervenantsExterieurs" rows="2" placeholder="Nom, entreprise, fonction..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- P.P.P. -->
                <div class="section">
                    <h3>üìä P.P.P. (Partages des Pratiques Professionnelles)</h3>
                    <div class="checkbox-grid">
                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin-bottom: 10px;">üîç Suivi et √©valuation</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp1" name="ppp" value="Suivi des actions pr√©c√©dentes">
                            <label for="ppp1">Suivi des actions pr√©c√©dentes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp2" name="ppp" value="Bilan des indicateurs">
                            <label for="ppp2">Bilan des indicateurs</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp3" name="ppp" value="√âvaluation des pratiques">
                            <label for="ppp3">√âvaluation des pratiques</label>
                        </div>
                        
                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">üõ†Ô∏è Outils et m√©thodes</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp4" name="ppp" value="Nouveaux outils">
                            <label for="ppp4">Nouveaux outils</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp5" name="ppp" value="M√©thodes innovantes">
                            <label for="ppp5">M√©thodes innovantes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp6" name="ppp" value="Retours d'exp√©rience">
                            <label for="ppp6">Retours d'exp√©rience</label>
                        </div>

                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">‚ö†Ô∏è Points de vigilance</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp7" name="ppp" value="Difficult√©s rencontr√©es">
                            <label for="ppp7">Difficult√©s rencontr√©es</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp8" name="ppp" value="Risques identifi√©s">
                            <label for="ppp8">Risques identifi√©s</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp9" name="ppp" value="Points d'am√©lioration">
                            <label for="ppp9">Points d'am√©lioration</label>
                        </div>

                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">üéØ Actions et projets</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp10" name="ppp" value="Nouvelles actions">
                            <label for="ppp10">Nouvelles actions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp11" name="ppp" value="Planning des projets">
                            <label for="ppp11">Planning des projets</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp12" name="ppp" value="Ressources n√©cessaires">
                            <label for="ppp12">Ressources n√©cessaires</label>
                        </div>
                    </div>
                </div>

                <!-- Ordre du jour -->
                <div class="section">
                    <h3>üìù Ordre du jour</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="ajouterPointOrdreJour()">‚ûï Ajouter un point</button>
                        <button type="button" class="btn btn-secondary" onclick="ouvrirTemplates()">üìã Templates</button>
                        <button type="button" class="btn btn-success" onclick="genererOrdreJourAuto()">ü§ñ G√©n√©rer auto</button>
                    </div>
                    <div id="ordreJourList" style="margin-top: 20px;"></div>
                </div>

                <!-- Synth√®se -->
                <div class="section">
                    <h3>üìÑ Synth√®se de la r√©union</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-success" onclick="genererSyntheseIA()">ü§ñ Compl√©ter avec IA</button>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="synthese">Synth√®se :</label>
                        <textarea id="synthese" name="synthese" rows="6" placeholder="Synth√®se de la r√©union..." onInput="updateCharCount('synthese', 1000)"></textarea>
                        <div class="char-counter" id="syntheseCount">0/1000 caract√®res</div>
                    </div>
                </div>

                <!-- Actions de finalisation -->
                <div class="section">
                    <h3>üéØ Finalisation</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="sauvegarder()">üíæ Sauvegarder</button>
                        <button type="button" class="btn btn-secondary" onclick="charger()">üìÇ Charger</button>
                        <button type="button" class="btn btn-success" onclick="genererPDF()">üìÑ G√©n√©rer PDF</button>
                        <button type="button" class="btn btn-primary" onclick="finaliserCompteRendu()">‚úì Finaliser le compte-rendu</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Templates -->
    <div id="templatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Templates d'ordre du jour</h3>
                <span class="close" onclick="fermerTemplates()">&times;</span>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-primary" onclick="appliquerTemplate(1)">Template 1 - Session de suivi op√©rationnel</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">Bilan d'activit√©, analyse des difficult√©s, coordination partenariale</p>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="appliquerTemplate(2)">Template 2 - √âvaluation trimestrielle</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">Indicateurs de performance, innovations p√©dagogiques, objectifs strat√©giques</p>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-success" onclick="appliquerTemplate(3)">Template 3 - Analyse des pratiques professionnelles</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">Analyse r√©flexive, capitalisation d'exp√©riences, am√©lioration continue</p>
            </div>
        </div>
    </div>

    <!-- Modal Chargement -->
    <div id="chargementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Charger un formulaire</h3>
                <span class="close" onclick="fermerChargement()">&times;</span>
            </div>
            <p>Chargement des sauvegardes...</p>
        </div>
    </div>

    <!-- Modal PDF -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-content">
            <div class="pdf-header">
                <h2>Compte-rendu de r√©union VS2</h2>
                <div>
                    <button class="btn" onclick="imprimerPDF()" style="background: white; color: #27ae60; margin-right: 10px;">üñ®Ô∏è Imprimer</button>
                    <button class="btn" onclick="telechargerPDF()" style="background: rgba(255,255,255,0.2); color: white; margin-right: 10px;">üíæ T√©l√©charger HTML</button>
                    <button class="btn" onclick="fermerPDF()" style="background: rgba(255,255,255,0.2); color: white;">‚úï Fermer</button>
                </div>
            </div>
            <div class="pdf-body" id="pdfContent"></div>
        </div>
    </div>

    <!-- Status de sauvegarde -->
    <div id="saveStatus" class="save-status">üíæ Sauvegard√© !</div>

    <script>
        let ordreJourCounter = 0;
        const consultantsList = [
            'Alicia DOUAIR', 'Nathalie TRILLO', 'Elodie ANTOINE', 'Caroline BRACONNIER', 
            'Farida BENZIADA', 'Michele BENEDICTO', 'Chitrasen LUXIMON'
        ];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updateHoraires(); // Calculer la dur√©e initiale
            updateAbsents();
            setupDragAndDrop();
            setupAutoSave();
        });

        // Ajout de la date √† la r√©f√©rence (nouveau syst√®me)
        function ajouterDateReference() {
            const dateInput = document.getElementById('date').value;
            const referenceInput = document.getElementById('reference');
            
            if (!dateInput) {
                alert('‚ö†Ô∏è Veuillez d\'abord s√©lectionner une date !');
                return;
            }
            
            const date = new Date(dateInput);
            const jour = String(date.getDate()).padStart(2, '0');
            const mois = String(date.getMonth() + 1).padStart(2, '0');
            const dateFormatee = jour + mois; // Format JJMM
            
            // Ajouter √† la fin de la r√©f√©rence existante
            let referenceActuelle = referenceInput.value;
            if (referenceActuelle && !referenceActuelle.endsWith('/')) {
                referenceActuelle += '/';
            }
            referenceInput.value = referenceActuelle + dateFormatee;
            
            updateProgress();
        }

        // Ancienne fonction de g√©n√©ration automatique (conserv√©e pour compatibilit√©)
        function updateReference() {
            // Plus utilis√©e mais conserv√©e pour √©viter les erreurs
        }

        // Gestion des horaires personnalis√©s
        function updateHoraires() {
            const debut = document.getElementById('heureDebut').value;
            const fin = document.getElementById('heureFin').value;
            
            if (debut && fin) {
                // Convertir en format d'affichage
                const debutFormat = debut.replace(':', 'h');
                const finFormat = fin.replace(':', 'h');
                
                // Calculer la dur√©e
                const [hDebut, mDebut] = debut.split(':').map(Number);
                const [hFin, mFin] = fin.split(':').map(Number);
                
                const minutesDebut = hDebut * 60 + mDebut;
                const minutesFin = hFin * 60 + mFin;
                const dureMinutes = minutesFin - minutesDebut;
                
                if (dureMinutes > 0) {
                    const heures = Math.floor(dureMinutes / 60);
                    const minutes = dureMinutes % 60;
                    
                    let dureeText = '';
                    if (heures > 0) dureeText += heures + 'h';
                    if (minutes > 0) dureeText += (heures > 0 ? '' : '') + (minutes < 10 && heures > 0 ? '0' : '') + minutes + (heures > 0 ? '' : 'min');
                    if (dureeText === '') dureeText = '0min';
                    
                    document.getElementById('dureeAffichage').textContent = `(${dureeText})`;
                    document.getElementById('horaires').value = `${debutFormat}00 √† ${finFormat}00`;
                } else {
                    document.getElementById('dureeAffichage').textContent = '(Dur√©e invalide)';
                    document.getElementById('dureeAffichage').style.color = '#e74c3c';
                    setTimeout(() => {
                        document.getElementById('dureeAffichage').style.color = '#666';
                    }, 2000);
                }
            }
            updateProgress();
        }

        // Gestion des absents automatique (quand on coche/d√©coche un pr√©sent)
        function updateAbsents() {
            const presents = Array.from(document.querySelectorAll('input[name="consultants"]:checked'))
                .map(cb => cb.value);
            
            // Mettre √† jour les checkboxes des absents
            consultantsList.forEach(consultant => {
                const absentCheckbox = document.querySelector(`input[name="absents"][value="${consultant}"]`);
                if (absentCheckbox) {
                    absentCheckbox.checked = !presents.includes(consultant);
                }
            });
            
            updateProgress();
        }

        // Gestion des pr√©sents automatique (quand on coche/d√©coche un absent)
        function updatePresents() {
            const absents = Array.from(document.querySelectorAll('input[name="absents"]:checked'))
                .map(cb => cb.value);
            
            // Mettre √† jour les checkboxes des pr√©sents
            consultantsList.forEach(consultant => {
                const presentCheckbox = document.querySelector(`input[name="consultants"][value="${consultant}"]`);
                if (presentCheckbox) {
                    presentCheckbox.checked = !absents.includes(consultant);
                }
            });
            
            updateProgress();
        }

        // Barre de progression
        function updateProgress() {
            const inputs = document.querySelectorAll('input[required]:not([type="hidden"]), select[required]');
            const filled = Array.from(inputs).filter(input => input.value.trim() !== '').length;
            const progress = (filled / inputs.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Gestion de l'ordre du jour
        function ajouterPointOrdreJour() {
            ordreJourCounter++;
            const container = document.getElementById('ordreJourList');
            const div = document.createElement('div');
            div.className = 'ordre-jour-item';
            div.draggable = true;
            div.innerHTML = `
                <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                <div style="margin-bottom: 10px;">
                    <input type="text" placeholder="Titre du point ${ordreJourCounter}" style="width: 100%; margin-bottom: 10px; font-size: 16px; padding: 12px; font-weight: 600;">
                    <textarea placeholder="Description et objectifs p√©dagogiques de ce point" style="width: 100%; font-size: 14px; padding: 12px; min-height: 80px;"></textarea>
                </div>
            `;
            container.appendChild(div);
            setupDragAndDrop();
        }

        function supprimerPoint(button) {
            button.parentElement.remove();
        }

        // Templates d'ordre du jour
        function ouvrirTemplates() {
            document.getElementById('templatesModal').style.display = 'block';
        }

        function fermerTemplates() {
            document.getElementById('templatesModal').style.display = 'none';
        }

        function appliquerTemplate(templateId) {
            const templates = {
                1: [
                    { titre: 'Tour de table et actualit√©s professionnelles', description: 'Pr√©sentation des participants, √©volution des dispositifs et actualit√©s du secteur de l\'insertion' },
                    { titre: 'Bilan d\'activit√© et indicateurs de performance', description: 'Analyse des r√©sultats quantitatifs et qualitatifs de la p√©riode √©coul√©e, taux de sorties positives' },
                    { titre: 'Difficult√©s d\'accompagnement et solutions d√©velopp√©es', description: 'Identification des freins rencontr√©s, partage de strat√©gies de contournement et bonnes pratiques' },
                    { titre: 'Coordination partenariale et d√©veloppement territorial', description: 'Point sur les relations avec les entreprises, collectivit√©s et organismes de formation' },
                    { titre: 'Plan d\'action et √©ch√©ances op√©rationnelles', description: 'D√©finition des priorit√©s, planning des actions et modalit√©s de suivi' }
                ],
                2: [
                    { titre: '√âvaluation trimestrielle des parcours d\'accompagnement', description: 'Analyse des indicateurs de performance, dur√©e moyenne des parcours, taux d\'insertion' },
                    { titre: 'Retours d\'exp√©rience sur les innovations p√©dagogiques', description: 'Pr√©sentation des nouvelles m√©thodologies test√©es et √©valuation de leur efficacit√©' },
                    { titre: 'Satisfaction des b√©n√©ficiaires et qualit√© de service', description: 'Analyse des enqu√™tes de satisfaction, points d\'am√©lioration identifi√©s' },
                    { titre: 'Objectifs strat√©giques pour le trimestre suivant', description: 'D√©finition des priorit√©s d\'action, nouvelles orientations m√©thodologiques' },
                    { titre: 'Besoins de formation et d√©veloppement des comp√©tences', description: 'Identification des besoins en formation continue, plan de professionnalisation' }
                ],
                3: [
                    { titre: 'Analyse r√©flexive des pratiques d\'accompagnement', description: '√âvaluation critique des m√©thodes utilis√©es, identification des leviers d\'am√©lioration' },
                    { titre: 'Capitalisation des exp√©riences et cas pratiques', description: 'Partage de situations complexes, co-construction de r√©ponses adapt√©es' },
                    { titre: 'Identification des bonnes pratiques transf√©rables', description: 'Recensement des innovations r√©ussies, modalit√©s de g√©n√©ralisation' },
                    { titre: 'Axes d\'am√©lioration continue et plan de progr√®s', description: 'D√©finition des orientations d\'am√©lioration, indicateurs de suivi de la qualit√©' },
                    { titre: 'Engagement sur les actions de d√©veloppement', description: 'Validation du plan d\'action, r√©partition des responsabilit√©s, calendrier de mise en ≈ìuvre' }
                ]
            };

            const points = templates[templateId];
            const container = document.getElementById('ordreJourList');
            container.innerHTML = '';
            
            points.forEach(point => {
                ordreJourCounter++;
                const div = document.createElement('div');
                div.className = 'ordre-jour-item';
                div.draggable = true;
                div.innerHTML = `
                    <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                    <div style="margin-bottom: 10px;">
                        <input type="text" value="${point.titre}" style="width: 100%; margin-bottom: 10px; font-size: 16px; padding: 12px; font-weight: 600;">
                        <textarea style="width: 100%; font-size: 14px; padding: 12px; min-height: 80px;">${point.description}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
            
            setupDragAndDrop();
            fermerTemplates();
        }

        // G√©n√©ration automatique bas√©e sur les P.P.P.
        function genererOrdreJourAuto() {
            const pppChecked = Array.from(document.querySelectorAll('input[name="ppp"]:checked'))
                .map(cb => cb.value);
            
            if (pppChecked.length === 0) {
                alert('Veuillez s√©lectionner au moins une th√©matique P.P.P. pour g√©n√©rer l\'ordre du jour automatiquement.');
                return;
            }

            const container = document.getElementById('ordreJourList');
            container.innerHTML = '';
            
            // Points fixes professionnels
            const pointsIntroductifs = [
                { 
                    titre: 'Ouverture de la s√©ance et tour de table', 
                    description: 'Pr√©sentation des participants, validation de l\'ordre du jour et objectifs de la s√©ance'
                },
                { 
                    titre: 'Bilan des actions de d√©veloppement pr√©c√©dentes', 
                    description: '√âvaluation de la mise en ≈ìuvre des actions d√©finies lors de la derni√®re session P.P.P.'
                }
            ];
            
            pointsIntroductifs.forEach(point => {
                ordreJourCounter++;
                const div = document.createElement('div');
                div.className = 'ordre-jour-item';
                div.draggable = true;
                div.innerHTML = `
                    <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                    <div style="margin-bottom: 10px;">
                        <input type="text" value="${point.titre}" style="width: 100%; margin-bottom: 10px; font-size: 16px; padding: 12px; font-weight: 600;">
                        <textarea style="width: 100%; font-size: 14px; padding: 12px; min-height: 80px;">${point.description}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });

            // Points bas√©s sur les P.P.P. avec langage professionnel
            const mappingPPP = {
                'Suivi des actions pr√©c√©dentes': {
                    titre: 'Analyse de l\'efficacit√© des dispositifs d\'accompagnement',
                    description: '√âvaluation des r√©sultats des actions mises en place, identification des leviers de r√©ussite et des axes d\'am√©lioration'
                },
                'Bilan des indicateurs': {
                    titre: 'Tableaux de bord et indicateurs de performance',
                    description: 'Analyse des donn√©es quantitatives et qualitatives, taux de sortie positive, dur√©e moyenne d\'accompagnement'
                },
                '√âvaluation des pratiques': {
                    titre: 'Analyse r√©flexive des m√©thodes d\'intervention',
                    description: '√âvaluation critique des outils et techniques utilis√©s, identification des bonnes pratiques transf√©rables'
                },
                'Nouveaux outils': {
                    titre: 'Pr√©sentation d\'outils innovants d\'accompagnement',
                    description: 'D√©couverte de nouvelles m√©thodologies, outils num√©riques et supports p√©dagogiques adapt√©s au public'
                },
                'M√©thodes innovantes': {
                    titre: 'Exp√©rimentation de d√©marches novatrices',
                    description: 'Partage d\'approches cr√©atives, techniques de mobilisation et strat√©gies d\'activation des b√©n√©ficiaires'
                },
                'Retours d\'exp√©rience': {
                    titre: 'Capitalisation des exp√©riences terrain',
                    description: 'Analyse de situations complexes, partage de cas pratiques et co-construction de solutions'
                },
                'Difficult√©s rencontr√©es': {
                    titre: 'Identification des freins √† l\'insertion professionnelle',
                    description: 'Analyse des obstacles rencontr√©s, probl√©matiques r√©currentes et strat√©gies de contournement'
                },
                'Risques identifi√©s': {
                    titre: 'Anticipation des risques de rupture de parcours',
                    description: 'D√©tection pr√©coce des signaux d\'alerte, mise en place de mesures pr√©ventives'
                },
                'Points d\'am√©lioration': {
                    titre: 'Optimisation des parcours d\'accompagnement',
                    description: 'Identification des axes de progression, am√©lioration continue des pratiques professionnelles'
                },
                'Nouvelles actions': {
                    titre: 'D√©finition des priorit√©s d\'action',
                    description: '√âlaboration de nouvelles strat√©gies d\'intervention, planification des actions prioritaires'
                },
                'Planning des projets': {
                    titre: 'Coordination des projets d\'insertion',
                    description: 'Planification des actions collectives, coordination avec les partenaires du territoire'
                },
                'Ressources n√©cessaires': {
                    titre: 'Mobilisation des ressources et partenariats',
                    description: 'Identification des besoins en formation, outils et partenariats strat√©giques'
                }
            };

            pppChecked.forEach(ppp => {
                const mapping = mappingPPP[ppp];
                if (mapping) {
                    ordreJourCounter++;
                    const div = document.createElement('div');
                    div.className = 'ordre-jour-item';
                    div.draggable = true;
                    div.innerHTML = `
                        <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                        <div style="margin-bottom: 10px;">
                            <input type="text" value="${mapping.titre}" style="width: 100%; margin-bottom: 10px; font-size: 16px; padding: 12px; font-weight: 600;">
                            <textarea style="width: 100%; font-size: 14px; padding: 12px; min-height: 80px;">${mapping.description}</textarea>
                        </div>
                    `;
                    container.appendChild(div);
                }
            });

            // Point de cl√¥ture professionnel
            ordreJourCounter++;
            const divCloture = document.createElement('div');
            divCloture.className = 'ordre-jour-item';
            divCloture.draggable = true;
            divCloture.innerHTML = `
                <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                <div style="margin-bottom: 10px;">
                    <input type="text" value="Synth√®se et engagement sur le plan d'action" style="width: 100%; margin-bottom: 10px; font-size: 16px; padding: 12px; font-weight: 600;">
                    <textarea style="width: 100%; font-size: 14px; padding: 12px; min-height: 80px;">R√©capitulatif des d√©cisions prises, validation du plan d'action, d√©finition des √©ch√©ances et modalit√©s de suivi</textarea>
                </div>
            `;
            container.appendChild(divCloture);
            
            setupDragAndDrop();
        }

        // Drag & Drop
        function setupDragAndDrop() {
            const items = document.querySelectorAll('.ordre-jour-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedHTML = e.dataTransfer.getData('text/html');
            this.insertAdjacentHTML('beforebegin', draggedHTML);
            const dragged = document.querySelector('.dragging');
            if (dragged) dragged.remove();
            setupDragAndDrop();
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        // G√©n√©ration de synth√®se IA
        function genererSyntheseIA() {
            const sites = Array.from(document.querySelectorAll('input[name="sites"]:checked')).map(cb => cb.value);
            const presents = Array.from(document.querySelectorAll('input[name="consultants"]:checked')).map(cb => cb.value);
            const ppp = Array.from(document.querySelectorAll('input[name="ppp"]:checked')).map(cb => cb.value);
            const ordreJour = Array.from(document.querySelectorAll('.ordre-jour-item input[type="text"]')).map(input => input.value).filter(val => val);

            let synthese = "SYNTH√àSE DE LA SESSION DE PARTAGES DES PRATIQUES PROFESSIONNELLES\n\n";
            
            synthese += "üìã CONTEXTE ET PARTICIPATION\n";
            if (sites.length > 0) {
                synthese += `Cette session P.P.P. a mobilis√© les √©quipes d'accompagnement de ${sites.length} site(s) : ${sites.join(', ')}. `;
            }
            
            if (presents.length > 0) {
                synthese += `L'implication de ${presents.length} consultant(s) en insertion professionnelle a permis une dynamique collaborative riche et constructive.\n\n`;
            }
            
            synthese += "üéØ TH√âMATIQUES D√âVELOPP√âES\n";
            if (ppp.length > 0) {
                synthese += "Les axes de travail prioritaires identifi√©s et trait√©s lors de cette session :\n";
                ppp.forEach(theme => {
                    const descriptions = {
                        'Suivi des actions pr√©c√©dentes': '‚Ä¢ √âvaluation de l\'efficacit√© des dispositifs d\'accompagnement pr√©c√©demment mis en ≈ìuvre',
                        'Bilan des indicateurs': '‚Ä¢ Analyse des tableaux de bord et indicateurs de performance des parcours d\'insertion',
                        '√âvaluation des pratiques': '‚Ä¢ Analyse r√©flexive des m√©thodes d\'intervention et techniques d\'accompagnement',
                        'Nouveaux outils': '‚Ä¢ Pr√©sentation et exp√©rimentation d\'outils innovants d\'accompagnement',
                        'M√©thodes innovantes': '‚Ä¢ D√©veloppement de d√©marches novatrices adapt√©es aux sp√©cificit√©s du public',
                        'Retours d\'exp√©rience': '‚Ä¢ Capitalisation des exp√©riences terrain et co-construction de solutions',
                        'Difficult√©s rencontr√©es': '‚Ä¢ Identification des freins √† l\'insertion et strat√©gies de contournement',
                        'Risques identifi√©s': '‚Ä¢ Anticipation des risques de rupture de parcours et mesures pr√©ventives',
                        'Points d\'am√©lioration': '‚Ä¢ Optimisation des parcours d\'accompagnement et am√©lioration continue',
                        'Nouvelles actions': '‚Ä¢ D√©finition des priorit√©s d\'action et nouvelles strat√©gies d\'intervention',
                        'Planning des projets': '‚Ä¢ Coordination des projets d\'insertion et planification territoriale',
                        'Ressources n√©cessaires': '‚Ä¢ Mobilisation des ressources et d√©veloppement de partenariats strat√©giques'
                    };
                    synthese += descriptions[theme] || `‚Ä¢ ${theme}`;
                    synthese += '\n';
                });
                synthese += '\n';
            }
            
            synthese += "üí° APPORTS M√âTHODOLOGIQUES\n";
            synthese += "‚Ä¢ Enrichissement mutuel des pratiques professionnelles par le partage d'exp√©riences\n";
            synthese += "‚Ä¢ Harmonisation des m√©thodes d'intervention sur l'ensemble du territoire\n";
            synthese += "‚Ä¢ Renforcement de la coh√©rence des parcours d'accompagnement\n";
            synthese += "‚Ä¢ D√©veloppement d'une culture commune de l'√©valuation et de l'am√©lioration continue\n\n";
            
            synthese += "üîç ANALYSE QUALITATIVE\n";
            synthese += "La session a permis d'identifier plusieurs leviers d'optimisation :\n";
            synthese += "‚Ä¢ Am√©lioration de la personnalisation des parcours d'accompagnement\n";
            synthese += "‚Ä¢ Renforcement de la coordination avec les acteurs du territoire\n";
            synthese += "‚Ä¢ D√©veloppement de nouvelles modalit√©s d'intervention adapt√©es aux √©volutions du march√© de l'emploi\n";
            synthese += "‚Ä¢ Capitalisation syst√©matique des innovations p√©dagogiques\n\n";
            
            synthese += "üìä INDICATEURS DE QUALIT√â\n";
            synthese += "‚Ä¢ Taux de participation √©lev√© t√©moignant de l'engagement des √©quipes\n";
            synthese += "‚Ä¢ Qualit√© des √©changes et richesse des retours d'exp√©rience partag√©s\n";
            synthese += "‚Ä¢ Dynamique collaborative favorisant l'√©mergence de solutions innovantes\n";
            synthese += "‚Ä¢ Appropriation collective des enjeux de d√©veloppement professionnel\n\n";
            
            synthese += "üéØ PLAN D'ACTION ET PERSPECTIVES\n";
            synthese += "Les orientations retenues s'articulent autour de :\n";
            synthese += "‚Ä¢ La syst√©matisation des pratiques identifi√©es comme efficientes\n";
            synthese += "‚Ä¢ Le renforcement des comp√©tences par la formation continue\n";
            synthese += "‚Ä¢ L'optimisation des outils d'accompagnement et de suivi\n";
            synthese += "‚Ä¢ La consolidation des partenariats op√©rationnels avec les entreprises du territoire";

            document.getElementById('synthese').value = synthese;
            updateCharCount('synthese', 1000);
        }

        // Compteur de caract√®res
        function updateCharCount(textareaId, maxLength) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(textareaId + 'Count');
            const currentLength = textarea.value.length;
            
            counter.textContent = `${currentLength}/${maxLength} caract√®res`;
            
            if (currentLength > maxLength * 0.9) {
                counter.className = 'char-counter danger';
            } else if (currentLength > maxLength * 0.7) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
            
            updateProgress();
        }

        // Sauvegarde automatique
        function setupAutoSave() {
            setInterval(() => {
                // Auto-save silencieux toutes les 30 secondes
                if (document.getElementById('date').value) {
                    showSaveStatus();
                }
            }, 30000);
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 2000);
        }

        // Fonctions de sauvegarde/chargement R√âELLES
        function sauvegarder() {
            const nomSauvegarde = prompt('Nom de la sauvegarde :', `R√©union_${new Date().toISOString().split('T')[0]}`);
            if (!nomSauvegarde) return;
            
            const formData = collectFormData();
            formData.ordreJourHTML = document.getElementById('ordreJourList').innerHTML;
            
            const sauvegarde = {
                nom: nomSauvegarde,
                date: new Date().toISOString(),
                data: formData
            };
            
            let sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            sauvegardes.push(sauvegarde);
            localStorage.setItem('sauvegardes_vs2', JSON.stringify(sauvegardes));
            
            showSaveStatus();
            alert(`‚úÖ Formulaire "${nomSauvegarde}" sauvegard√© avec succ√®s !`);
        }

        function charger() {
            const sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            const modalContent = document.querySelector('#chargementModal .modal-content');
            
            if (sauvegardes.length === 0) {
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3>üìÇ Charger un formulaire</h3>
                        <span class="close" onclick="fermerChargement()">&times;</span>
                    </div>
                    <p>Aucune sauvegarde trouv√©e. Cr√©ez d'abord une sauvegarde en remplissant le formulaire et en cliquant sur "üíæ Sauvegarder".</p>
                `;
            } else {
                let html = `
                    <div class="modal-header">
                        <h3>üìÇ Charger un formulaire (${sauvegardes.length} sauvegarde(s))</h3>
                        <span class="close" onclick="fermerChargement()">&times;</span>
                    </div>
                `;
                
                sauvegardes.reverse().forEach((save, index) => {
                    const realIndex = sauvegardes.length - 1 - index;
                    const dateFormatee = new Date(save.date).toLocaleString('fr-FR');
                    html += `
                        <div style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #f8f9fa;">
                            <button class="btn btn-primary" onclick="chargerFormulaire(${realIndex})" style="margin-bottom: 5px; width: 100%;">${save.nom}</button>
                            <p style="font-size: 12px; color: #666; margin: 0;">Sauvegard√© le: ${dateFormatee}</p>
                            <button class="btn" onclick="supprimerSauvegarde(${realIndex})" style="background: #e74c3c; color: white; font-size: 11px; padding: 3px 8px; margin-top: 5px;">üóëÔ∏è Supprimer</button>
                        </div>
                    `;
                });
                
                modalContent.innerHTML = html;
            }
            
            document.getElementById('chargementModal').style.display = 'block';
        }

        function fermerChargement() {
            document.getElementById('chargementModal').style.display = 'none';
        }

        function chargerFormulaire(index) {
            const sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            const sauvegarde = sauvegardes[index];
            
            if (!sauvegarde) {
                alert('Erreur : Sauvegarde introuvable');
                return;
            }
            
            const data = sauvegarde.data;
            
            // Charger les champs de base
            document.getElementById('date').value = data.date || '';
            document.getElementById('reference').value = data.reference || '';
            
            // Charger les horaires (nouveau syst√®me)
            if (data.heureDebut && data.heureFin) {
                document.getElementById('heureDebut').value = data.heureDebut;
                document.getElementById('heureFin').value = data.heureFin;
                updateHoraires();
            } else if (data.horaires) {
                // Compatibilit√© avec ancien syst√®me
                document.getElementById('horaires').value = data.horaires;
            }
            
            document.getElementById('animateur').value = data.animateur || '';
            document.getElementById('modalite').value = data.modalite || '';
            document.getElementById('intervenantsSolerys').value = data.intervenantsSolerys || '';
            document.getElementById('intervenantsExterieurs').value = data.intervenantsExterieurs || '';
            document.getElementById('synthese').value = data.synthese || '';
            
            // Charger les sites
            document.querySelectorAll('input[name="sites"]').forEach(cb => {
                cb.checked = data.sites && data.sites.includes(cb.value);
            });
            
            // Charger les consultants pr√©sents
            document.querySelectorAll('input[name="consultants"]').forEach(cb => {
                cb.checked = data.presents && data.presents.includes(cb.value);
            });
            
            // Charger les consultants absents
            document.querySelectorAll('input[name="absents"]').forEach(cb => {
                cb.checked = data.absentsChecked && data.absentsChecked.includes(cb.value);
            });
            
            // Charger les P.P.P.
            document.querySelectorAll('input[name="ppp"]').forEach(cb => {
                cb.checked = data.ppp && data.ppp.includes(cb.value);
            });
            
            // Charger l'ordre du jour
            if (data.ordreJourHTML) {
                document.getElementById('ordreJourList').innerHTML = data.ordreJourHTML;
                setupDragAndDrop();
            }
            
            // Mettre √† jour les champs calcul√©s
            updateAbsents();
            updateProgress();
            updateCharCount('synthese', 1000);
            
            fermerChargement();
            alert(`‚úÖ Formulaire "${sauvegarde.nom}" charg√© avec succ√®s !`);
        }

        function supprimerSauvegarde(index) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette sauvegarde ?')) return;
            
            let sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            sauvegardes.splice(index, 1);
            localStorage.setItem('sauvegardes_vs2', JSON.stringify(sauvegardes));
            
            // Recharger la liste
            charger();
        }

        // Finalisation
        function finaliserCompteRendu() {
            const date = document.getElementById('date').value;
            const animateur = document.getElementById('animateur').value;
            const modalite = document.getElementById('modalite').value;
            const heureDebut = document.getElementById('heureDebut').value;
            const heureFin = document.getElementById('heureFin').value;
            
            if (!date || !animateur || !modalite || !heureDebut || !heureFin) {
                alert('‚ö†Ô∏è Veuillez remplir les champs obligatoires :\n- Date\n- Horaires (d√©but et fin)\n- Animateur\n- Modalit√©');
                return;
            }
            
            const confirmer = confirm('‚úì Compte-rendu finalis√© avec succ√®s !\n\nüìÑ Souhaitez-vous g√©n√©rer le PDF maintenant ?');
            if (confirmer) {
                genererPDF();
            }
        }

        // G√©n√©ration PDF
        function genererPDF() {
            const verifier = confirm(`üìã V√©rifier et valider le compte-rendu

‚ö†Ô∏è Avant de g√©n√©rer le PDF, assurez-vous que :
- Toutes les informations sont correctes
- La synth√®se est compl√®te  
- Les participants sont bien list√©s
- L'ordre du jour est finalis√©

Voulez-vous continuer la g√©n√©ration du PDF ?`);
            
            if (!verifier) {
                return;
            }

            try {
                const formData = collectFormData();
                const pdfContent = generatePDFContent(formData);
                
                // Ouvrir dans une nouvelle page
                const pdfWindow = window.open('', '_blank');
                pdfWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="fr">
                    <head>
                        <meta charset="UTF-8">
                        <title>Compte-rendu VS2 - ${formData.date}</title>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.4; margin: 20px; }
                            .pdf-header { background: #27ae60; color: white; padding: 20px; margin: -20px -20px 30px -20px; text-align: center; }
                            .section { margin-bottom: 25px; page-break-inside: avoid; }
                            .section-title { color: #27ae60; font-size: 18px; font-weight: bold; border-bottom: 2px solid #27ae60; padding-bottom: 8px; margin-bottom: 15px; }
                            .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
                            .info-item { background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 4px solid #27ae60; }
                            .info-label { font-weight: bold; color: #2c3e50; display: block; margin-bottom: 5px; }
                            .list-item { margin-bottom: 8px; padding-left: 20px; }
                            .ordre-jour-item { background: #f8f9fa; padding: 15px; margin-bottom: 12px; border-radius: 6px; border-left: 4px solid #3498db; }
                            .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #666; border-top: 2px solid #ddd; padding-top: 20px; }
                            .print-button { background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 20px 0; }
                            .print-button:hover { background: #229954; }
                            @media print { 
                                body { margin: 0; }
                                .pdf-header { background: #27ae60 !important; -webkit-print-color-adjust: exact; }
                                .no-print { display: none !important; }
                                .info-item, .ordre-jour-item { border-left: 4px solid #000 !important; }
                            }
                        </style>
                    </head>
                    <body>
                        ${pdfContent}
                        <div class="no-print" style="text-align: center; margin: 30px 0;">
                            <button onclick="window.print()" class="print-button">üñ®Ô∏è Imprimer / Sauvegarder en PDF</button>
                            <button onclick="window.close()" class="print-button" style="background: #95a5a6; margin-left: 10px;">‚úï Fermer</button>
                        </div>
                    </body>
                    </html>
                `);
                pdfWindow.document.close();
                
            } catch (error) {
                alert('Erreur lors de la g√©n√©ration du PDF : ' + error.message);
            }
        }

        function collectFormData() {
            return {
                reference: document.getElementById('reference').value || 'N/A',
                date: document.getElementById('date').value || 'N/A',
                heureDebut: document.getElementById('heureDebut').value || '14:00',
                heureFin: document.getElementById('heureFin').value || '16:00',
                horaires: document.getElementById('horaires').value || 'N/A',
                animateur: document.getElementById('animateur').value || 'N/A',
                modalite: document.getElementById('modalite').value || 'N/A',
                sites: Array.from(document.querySelectorAll('input[name="sites"]:checked')).map(cb => cb.value),
                presents: Array.from(document.querySelectorAll('input[name="consultants"]:checked')).map(cb => cb.value),
                absentsChecked: Array.from(document.querySelectorAll('input[name="absents"]:checked')).map(cb => cb.value),
                absents: Array.from(document.querySelectorAll('input[name="absents"]:checked')).map(cb => cb.value).join(', ') || 'Aucun',
                intervenantsSolerys: document.getElementById('intervenantsSolerys').value || 'N/A',
                intervenantsExterieurs: document.getElementById('intervenantsExterieurs').value || 'N/A',
                ppp: Array.from(document.querySelectorAll('input[name="ppp"]:checked')).map(cb => cb.value),
                ordreJour: Array.from(document.querySelectorAll('.ordre-jour-item')).map(item => {
                    const titre = item.querySelector('input[type="text"]')?.value || '';
                    const description = item.querySelector('textarea')?.value || '';
                    return { titre, description };
                }).filter(item => item.titre),
                synthese: document.getElementById('synthese').value || 'N/A'
            };
        }

        function generatePDFContent(data) {
            return `
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.4; margin: 0; }
                    .pdf-header { background: #27ae60; color: white; padding: 15px; margin: -20px -20px 20px -20px; text-align: center; }
                    .section { margin-bottom: 20px; page-break-inside: avoid; }
                    .section-title { color: #27ae60; font-size: 16px; font-weight: bold; border-bottom: 1px solid #27ae60; padding-bottom: 5px; margin-bottom: 10px; }
                    .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px; }
                    .info-item { background: #f8f9fa; padding: 8px; border-radius: 4px; }
                    .info-label { font-weight: bold; color: #2c3e50; }
                    .list-item { margin-bottom: 5px; padding-left: 15px; }
                    .ordre-jour-item { background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 4px; }
                    .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }
                    @media print { 
                        body { margin: 0; }
                        .pdf-header { background: #27ae60 !important; }
                        .no-print { display: none; }
                    }
                </style>
                
                <div class="pdf-header">
                    <h1>Compte-rendu de R√©union d'√©quipe VS2</h1>
                    <p>Partages des Pratiques Professionnelles - Solerys</p>
                    <button onclick="window.print()" class="no-print" style="background: white; color: #27ae60; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px;">üñ®Ô∏è Imprimer / Sauvegarder en PDF</button>
                </div>

                <div class="section">
                    <div class="section-title">üìã Informations g√©n√©rales</div>
                    <div class="info-grid">
                        <div class="info-item"><span class="info-label">R√©f√©rence:</span> ${data.reference}</div>
                        <div class="info-item"><span class="info-label">Date:</span> ${data.date}</div>
                        <div class="info-item"><span class="info-label">Horaires:</span> ${data.horaires}</div>
                        <div class="info-item"><span class="info-label">Animateur:</span> ${data.animateur}</div>
                        <div class="info-item"><span class="info-label">Modalit√©:</span> ${data.modalite}</div>
                    </div>
                </div>

                ${data.sites.length > 0 ? `
                <div class="section">
                    <div class="section-title">üè¢ Sites concern√©s</div>
                    ${data.sites.map(site => `<div class="list-item">‚Ä¢ ${site}</div>`).join('')}
                </div>
                ` : ''}

                <div class="section">
                    <div class="section-title">üë• Participants</div>
                    ${data.presents.length > 0 ? `
                    <div style="margin-bottom: 15px;">
                        <strong>Consultants pr√©sents:</strong><br>
                        ${data.presents.map(p => `<div class="list-item">‚Ä¢ ${p}</div>`).join('')}
                    </div>
                    ` : ''}
                    <div>
                        <strong>Consultants absents:</strong> ${data.absents}
                    </div>
                </div>

                ${data.intervenantsSolerys !== 'N/A' || data.intervenantsExterieurs !== 'N/A' ? `
                <div class="section">
                    <div class="section-title">üéØ Intervenants</div>
                    ${data.intervenantsSolerys !== 'N/A' ? `<div><strong>Solerys:</strong> ${data.intervenantsSolerys}</div>` : ''}
                    ${data.intervenantsExterieurs !== 'N/A' ? `<div><strong>Ext√©rieurs:</strong> ${data.intervenantsExterieurs}</div>` : ''}
                </div>
                ` : ''}

                ${data.ppp.length > 0 ? `
                <div class="section">
                    <div class="section-title">üìä P.P.P. abord√©es</div>
                    ${data.ppp.map(ppp => `<div class="list-item">‚Ä¢ ${ppp}</div>`).join('')}
                </div>
                ` : ''}

                ${data.ordreJour.length > 0 ? `
                <div class="section">
                    <div class="section-title">üìù Ordre du jour</div>
                    ${data.ordreJour.map((item, index) => `
                        <div class="ordre-jour-item">
                            <strong>${index + 1}. ${item.titre}</strong>
                            ${item.description ? `<div style="margin-top: 5px; font-style: italic;">${item.description}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                ${data.synthese !== 'N/A' ? `
                <div class="section">
                    <div class="section-title">üìÑ Synth√®se</div>
                    <div style="white-space: pre-line; background: #f8f9fa; padding: 15px; border-radius: 4px;">${data.synthese}</div>
                </div>
                ` : ''}

                <div class="footer">
                    <strong>SOLERYS - OASYS & Cie</strong><br>
                    www.solerys.fr<br>
                    Document g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
                </div>
            `;
        }

        function imprimerPDF() {
            try {
                const printWindow = window.open('', '_blank');
                if (printWindow) {
                    printWindow.document.write(document.getElementById('pdfContent').innerHTML);
                    printWindow.document.close();
                    printWindow.print();
                } else {
                    alert('Veuillez autoriser les fen√™tres popup pour imprimer le document.');
                }
            } catch (error) {
                alert('Erreur lors de l\'impression : ' + error.message);
            }
        }

        function telechargerPDF() {
            try {
                const content = document.getElementById('pdfContent').innerHTML;
                const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
                const filename = `Compte-rendu-VS2-${date}.html`;
                
                const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Compte-rendu VS2</title></head><body>${content}</body></html>`], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('üìÑ Fichier t√©l√©charg√© ! Ouvrez-le dans votre navigateur et utilisez Ctrl+P pour l\'imprimer en PDF.');
            } catch (error) {
                alert('Erreur lors du t√©l√©chargement : ' + error.message);
            }
        }

        function fermerPDF() {
            document.getElementById('pdfModal').style.display = 'none';
        }

        // Event listeners
        document.getElementById('heureDebut').addEventListener('change', updateHoraires);
        document.getElementById('heureFin').addEventListener('change', updateHoraires);
        document.addEventListener('input', updateProgress);

        // Fermeture des modals en cliquant √† l'ext√©rieur
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            if (event.target === document.getElementById('pdfModal')) {
                fermerPDF();
            }
        });
    </script>
</body>
</html>
