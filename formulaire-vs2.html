<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire R√©union √âquipe VS2 - Solerys</title>
    <meta name="description" content="Formulaire pour organiser les r√©unions d'√©quipe VS2 et g√©n√©rer automatiquement les comptes-rendus">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 50%, #58d68d 100%);
            color: white;
            padding: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(180deg); }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .website {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: #27ae60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .company {
            font-size: 18px;
            font-weight: 600;
        }

        .header-right {
            text-align: right;
        }

        .meeting-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .meeting-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .header-right {
                text-align: center;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e8ecef;
            border-radius: 10px;
            background: #fafbfc;
        }

        .section h3 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e8ecef;
            transition: background-color 0.2s;
        }

        .checkbox-item:hover {
            background: #f8f9fa;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #3498db, #5dade2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .ordre-jour-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.2s;
        }

        .ordre-jour-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ordre-jour-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .delete-item {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            float: right;
            font-size: 12px;
        }

        .char-counter {
            font-size: 12px;
            color: #7f8c8d;
            text-align: right;
            margin-top: 5px;
        }

        .char-counter.warning {
            color: #e67e22;
        }

        .char-counter.danger {
            color: #e74c3c;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .pdf-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
        }

        .pdf-content {
            background: white;
            margin: 20px;
            height: calc(100vh - 40px);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }

        .pdf-header {
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .save-status.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .form-container {
                padding: 20px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="website">www.solerys.fr</div>
                <div class="logo-section">
                    <div class="logo">S</div>
                    <div class="company">OASYS & Cie</div>
                </div>
            </div>
            <div class="header-right">
                <div class="meeting-title">R√©union d'√©quipe VS2</div>
                <div class="meeting-subtitle">Partages des Pratiques Professionnelles</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="form-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <form id="reunionForm">
                <!-- Informations g√©n√©rales -->
                <div class="section">
                    <h3>üìã Informations g√©n√©rales</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reference">R√©f√©rence :</label>
                            <input type="text" id="reference" name="reference" readonly>
                        </div>
                        <div class="form-group">
                            <label for="date">Date :</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Horaires :</label>
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr auto; gap: 10px; align-items: center;">
                                <div>
                                    <label for="heureDebut" style="font-size: 12px; margin-bottom: 3px;">D√©but :</label>
                                    <input type="time" id="heureDebut" name="heureDebut" value="14:00" required onchange="updateHoraires()">
                                </div>
                                <span style="margin-top: 20px;">√†</span>
                                <div>
                                    <label for="heureFin" style="font-size: 12px; margin-bottom: 3px;">Fin :</label>
                                    <input type="time" id="heureFin" name="heureFin" value="16:00" required onchange="updateHoraires()">
                                </div>
                                <div style="margin-top: 20px; font-size: 12px; color: #666;" id="dureeAffichage">(2h)</div>
                            </div>
                            <input type="hidden" id="horaires" name="horaires" value="14h00 √† 16h00">
                        </div>
                        <div class="form-group">
                            <label for="animateur">Animateur :</label>
                            <input type="text" id="animateur" name="animateur" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="modalite">Modalit√© :</label>
                            <select id="modalite" name="modalite" required>
                                <option value="">Choisir la modalit√©</option>
                                <option value="Pr√©sentiel">Pr√©sentiel</option>
                                <option value="Distanciel">Distanciel</option>
                                <option value="Hybride">Hybride</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sites concern√©s -->
                <div class="section">
                    <h3>üè¢ Sites concern√©s</h3>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" id="site1" name="sites" value="Strasbourg">
                            <label for="site1">Strasbourg</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site2" name="sites" value="Haguenau">
                            <label for="site2">Haguenau</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site3" name="sites" value="Molsheim">
                            <label for="site3">Molsheim</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site4" name="sites" value="Saverne">
                            <label for="site4">Saverne</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="site5" name="sites" value="S√©lestat">
                            <label for="site5">S√©lestat</label>
                        </div>
                    </div>
                </div>

                <!-- Participants -->
                <div class="section">
                    <h3>üë• Participants</h3>
                    
                    <h4 style="color: #27ae60; margin-bottom: 10px;">Consultants pr√©sents :</h4>
                    <div class="checkbox-grid" id="consultantsPresents">
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons1" name="consultants" value="Alicia DOUAIR" onchange="updateAbsents()">
                            <label for="cons1">Alicia DOUAIR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons2" name="consultants" value="Nathalie TRILLO" onchange="updateAbsents()">
                            <label for="cons2">Nathalie TRILLO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons3" name="consultants" value="Elodie ANTOINE" onchange="updateAbsents()">
                            <label for="cons3">Elodie ANTOINE</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons4" name="consultants" value="Caroline BRACONNIER" onchange="updateAbsents()">
                            <label for="cons4">Caroline BRACONNIER</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons5" name="consultants" value="Farida BENZIADA" onchange="updateAbsents()">
                            <label for="cons5">Farida BENZIADA</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons6" name="consultants" value="Michele BENEDICTO" onchange="updateAbsents()">
                            <label for="cons6">Michele BENEDICTO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cons7" name="consultants" value="Chitrasen LUXIMON" onchange="updateAbsents()">
                            <label for="cons7">Chitrasen LUXIMON</label>
                        </div>
                    </div>
                    
                    <h4 style="color: #e74c3c; margin: 20px 0 10px 0;">Consultants absents :</h4>
                    <div class="checkbox-grid" id="consultantsAbsents">
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs1" name="absents" value="Alicia DOUAIR" checked onchange="updatePresents()">
                            <label for="abs1">Alicia DOUAIR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs2" name="absents" value="Nathalie TRILLO" checked onchange="updatePresents()">
                            <label for="abs2">Nathalie TRILLO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs3" name="absents" value="Elodie ANTOINE" checked onchange="updatePresents()">
                            <label for="abs3">Elodie ANTOINE</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs4" name="absents" value="Caroline BRACONNIER" checked onchange="updatePresents()">
                            <label for="abs4">Caroline BRACONNIER</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs5" name="absents" value="Farida BENZIADA" checked onchange="updatePresents()">
                            <label for="abs5">Farida BENZIADA</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs6" name="absents" value="Michele BENEDICTO" checked onchange="updatePresents()">
                            <label for="abs6">Michele BENEDICTO</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abs7" name="absents" value="Chitrasen LUXIMON" checked onchange="updatePresents()">
                            <label for="abs7">Chitrasen LUXIMON</label>
                        </div>
                    </div>
                </div>

                <!-- Intervenants -->
                <div class="section">
                    <h3>üéØ Intervenants</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="intervenantsSolerys">Intervenants Solerys :</label>
                            <textarea id="intervenantsSolerys" name="intervenantsSolerys" rows="2" placeholder="Nom, fonction..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="intervenantsExterieurs">Intervenants ext√©rieurs :</label>
                            <textarea id="intervenantsExterieurs" name="intervenantsExterieurs" rows="2" placeholder="Nom, entreprise, fonction..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- P.P.P. -->
                <div class="section">
                    <h3>üìä P.P.P. (Partages des Pratiques Professionnelles)</h3>
                    <div class="checkbox-grid">
                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin-bottom: 10px;">üîç Suivi et √©valuation</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp1" name="ppp" value="Suivi des actions pr√©c√©dentes">
                            <label for="ppp1">Suivi des actions pr√©c√©dentes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp2" name="ppp" value="Bilan des indicateurs">
                            <label for="ppp2">Bilan des indicateurs</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp3" name="ppp" value="√âvaluation des pratiques">
                            <label for="ppp3">√âvaluation des pratiques</label>
                        </div>
                        
                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">üõ†Ô∏è Outils et m√©thodes</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp4" name="ppp" value="Nouveaux outils">
                            <label for="ppp4">Nouveaux outils</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp5" name="ppp" value="M√©thodes innovantes">
                            <label for="ppp5">M√©thodes innovantes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp6" name="ppp" value="Retours d'exp√©rience">
                            <label for="ppp6">Retours d'exp√©rience</label>
                        </div>

                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">‚ö†Ô∏è Points de vigilance</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp7" name="ppp" value="Difficult√©s rencontr√©es">
                            <label for="ppp7">Difficult√©s rencontr√©es</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp8" name="ppp" value="Risques identifi√©s">
                            <label for="ppp8">Risques identifi√©s</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp9" name="ppp" value="Points d'am√©lioration">
                            <label for="ppp9">Points d'am√©lioration</label>
                        </div>

                        <div style="grid-column: 1/-1; font-weight: bold; color: #27ae60; margin: 20px 0 10px 0;">üéØ Actions et projets</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp10" name="ppp" value="Nouvelles actions">
                            <label for="ppp10">Nouvelles actions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp11" name="ppp" value="Planning des projets">
                            <label for="ppp11">Planning des projets</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ppp12" name="ppp" value="Ressources n√©cessaires">
                            <label for="ppp12">Ressources n√©cessaires</label>
                        </div>
                    </div>
                </div>

                <!-- Ordre du jour -->
                <div class="section">
                    <h3>üìù Ordre du jour</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="ajouterPointOrdreJour()">‚ûï Ajouter un point</button>
                        <button type="button" class="btn btn-secondary" onclick="ouvrirTemplates()">üìã Templates</button>
                        <button type="button" class="btn btn-success" onclick="genererOrdreJourAuto()">ü§ñ G√©n√©rer auto</button>
                    </div>
                    <div id="ordreJourList" style="margin-top: 20px;"></div>
                </div>

                <!-- Synth√®se -->
                <div class="section">
                    <h3>üìÑ Synth√®se de la r√©union</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-success" onclick="genererSyntheseIA()">ü§ñ Compl√©ter avec IA</button>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="synthese">Synth√®se :</label>
                        <textarea id="synthese" name="synthese" rows="6" placeholder="Synth√®se de la r√©union..." onInput="updateCharCount('synthese', 1000)"></textarea>
                        <div class="char-counter" id="syntheseCount">0/1000 caract√®res</div>
                    </div>
                </div>

                <!-- Actions de finalisation -->
                <div class="section">
                    <h3>üéØ Finalisation</h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="sauvegarder()">üíæ Sauvegarder</button>
                        <button type="button" class="btn btn-secondary" onclick="charger()">üìÇ Charger</button>
                        <button type="button" class="btn btn-success" onclick="genererPDF()">üìÑ G√©n√©rer PDF</button>
                        <button type="button" class="btn btn-primary" onclick="finaliserCompteRendu()">‚úì Finaliser le compte-rendu</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Templates -->
    <div id="templatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Templates d'ordre du jour</h3>
                <span class="close" onclick="fermerTemplates()">&times;</span>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-primary" onclick="appliquerTemplate(1)">Template 1 - R√©union de suivi</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">Points de suivi, avancement des projets, difficult√©s</p>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="appliquerTemplate(2)">Template 2 - Bilan trimestriel</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">Indicateurs, r√©sultats, objectifs prochaine p√©riode</p>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-success" onclick="appliquerTemplate(3)">Template 3 - R√©union d'√©valuation</button>
                <p style="font-size: 12px; color: #666; margin: 5px 0;">√âvaluation des pratiques, retours d'exp√©rience, am√©liorations</p>
            </div>
        </div>
    </div>

    <!-- Modal Chargement -->
    <div id="chargementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Charger un formulaire</h3>
                <span class="close" onclick="fermerChargement()">&times;</span>
            </div>
            <p>Chargement des sauvegardes...</p>
        </div>
    </div>

    <!-- Modal PDF -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-content">
            <div class="pdf-header">
                <h2>Compte-rendu de r√©union VS2</h2>
                <div>
                    <button class="btn" onclick="imprimerPDF()" style="background: white; color: #27ae60; margin-right: 10px;">üñ®Ô∏è Imprimer</button>
                    <button class="btn" onclick="telechargerPDF()" style="background: rgba(255,255,255,0.2); color: white; margin-right: 10px;">üíæ T√©l√©charger HTML</button>
                    <button class="btn" onclick="fermerPDF()" style="background: rgba(255,255,255,0.2); color: white;">‚úï Fermer</button>
                </div>
            </div>
            <div class="pdf-body" id="pdfContent"></div>
        </div>
    </div>

    <!-- Status de sauvegarde -->
    <div id="saveStatus" class="save-status">üíæ Sauvegard√© !</div>

    <script>
        let ordreJourCounter = 0;
        const consultantsList = [
            'Alicia DOUAIR', 'Nathalie TRILLO', 'Elodie ANTOINE', 'Caroline BRACONNIER', 
            'Farida BENZIADA', 'Michele BENEDICTO', 'Chitrasen LUXIMON'
        ];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateReference();
            updateProgress();
            updateHoraires(); // Calculer la dur√©e initiale
            updateAbsents();
            setupDragAndDrop();
            setupAutoSave();
        });

        // G√©n√©ration automatique de la r√©f√©rence
        function updateReference() {
            const dateInput = document.getElementById('date');
            const referenceInput = document.getElementById('reference');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                referenceInput.value = `VS2-${year}${month}${day}`;
            }
        }

        // Gestion des horaires personnalis√©s
        function updateHoraires() {
            const debut = document.getElementById('heureDebut').value;
            const fin = document.getElementById('heureFin').value;
            
            if (debut && fin) {
                // Convertir en format d'affichage
                const debutFormat = debut.replace(':', 'h');
                const finFormat = fin.replace(':', 'h');
                
                // Calculer la dur√©e
                const [hDebut, mDebut] = debut.split(':').map(Number);
                const [hFin, mFin] = fin.split(':').map(Number);
                
                const minutesDebut = hDebut * 60 + mDebut;
                const minutesFin = hFin * 60 + mFin;
                const dureMinutes = minutesFin - minutesDebut;
                
                if (dureMinutes > 0) {
                    const heures = Math.floor(dureMinutes / 60);
                    const minutes = dureMinutes % 60;
                    
                    let dureeText = '';
                    if (heures > 0) dureeText += heures + 'h';
                    if (minutes > 0) dureeText += (heures > 0 ? '' : '') + (minutes < 10 && heures > 0 ? '0' : '') + minutes + (heures > 0 ? '' : 'min');
                    if (dureeText === '') dureeText = '0min';
                    
                    document.getElementById('dureeAffichage').textContent = `(${dureeText})`;
                    document.getElementById('horaires').value = `${debutFormat}00 √† ${finFormat}00`;
                } else {
                    document.getElementById('dureeAffichage').textContent = '(Dur√©e invalide)';
                    document.getElementById('dureeAffichage').style.color = '#e74c3c';
                    setTimeout(() => {
                        document.getElementById('dureeAffichage').style.color = '#666';
                    }, 2000);
                }
            }
            updateProgress();
        }

        // Gestion des absents automatique (quand on coche/d√©coche un pr√©sent)
        function updateAbsents() {
            const presents = Array.from(document.querySelectorAll('input[name="consultants"]:checked'))
                .map(cb => cb.value);
            
            // Mettre √† jour les checkboxes des absents
            consultantsList.forEach(consultant => {
                const absentCheckbox = document.querySelector(`input[name="absents"][value="${consultant}"]`);
                if (absentCheckbox) {
                    absentCheckbox.checked = !presents.includes(consultant);
                }
            });
            
            updateProgress();
        }

        // Gestion des pr√©sents automatique (quand on coche/d√©coche un absent)
        function updatePresents() {
            const absents = Array.from(document.querySelectorAll('input[name="absents"]:checked'))
                .map(cb => cb.value);
            
            // Mettre √† jour les checkboxes des pr√©sents
            consultantsList.forEach(consultant => {
                const presentCheckbox = document.querySelector(`input[name="consultants"][value="${consultant}"]`);
                if (presentCheckbox) {
                    presentCheckbox.checked = !absents.includes(consultant);
                }
            });
            
            updateProgress();
        }

        // Barre de progression
        function updateProgress() {
            const inputs = document.querySelectorAll('input[required]:not([type="hidden"]), select[required]');
            const filled = Array.from(inputs).filter(input => input.value.trim() !== '').length;
            const progress = (filled / inputs.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Gestion de l'ordre du jour
        function ajouterPointOrdreJour() {
            ordreJourCounter++;
            const container = document.getElementById('ordreJourList');
            const div = document.createElement('div');
            div.className = 'ordre-jour-item';
            div.draggable = true;
            div.innerHTML = `
                <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                <div style="margin-bottom: 10px;">
                    <input type="text" placeholder="Titre du point ${ordreJourCounter}" style="width: 100%; margin-bottom: 5px;">
                    <textarea placeholder="Description (optionnelle)" rows="2" style="width: 100%;"></textarea>
                </div>
            `;
            container.appendChild(div);
            setupDragAndDrop();
        }

        function supprimerPoint(button) {
            button.parentElement.remove();
        }

        // Templates d'ordre du jour
        function ouvrirTemplates() {
            document.getElementById('templatesModal').style.display = 'block';
        }

        function fermerTemplates() {
            document.getElementById('templatesModal').style.display = 'none';
        }

        function appliquerTemplate(templateId) {
            const templates = {
                1: [
                    'Tour de table et actualit√©s',
                    'Suivi des actions de la r√©union pr√©c√©dente',
                    'Avancement des projets en cours',
                    'Difficult√©s rencontr√©es et solutions',
                    'Actions √† mener pour la prochaine p√©riode'
                ],
                2: [
                    'Bilan des indicateurs du trimestre',
                    'Analyse des r√©sultats obtenus',
                    'Retours clients et satisfaction',
                    'Objectifs pour le prochain trimestre',
                    'Ressources et moyens n√©cessaires'
                ],
                3: [
                    '√âvaluation des pratiques actuelles',
                    'Retours d\'exp√©rience des consultants',
                    'Identification des bonnes pratiques',
                    'Points d\'am√©lioration identifi√©s',
                    'Plan d\'action pour l\'am√©lioration'
                ]
            };

            const points = templates[templateId];
            const container = document.getElementById('ordreJourList');
            container.innerHTML = '';
            
            points.forEach(point => {
                ordreJourCounter++;
                const div = document.createElement('div');
                div.className = 'ordre-jour-item';
                div.draggable = true;
                div.innerHTML = `
                    <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                    <div style="margin-bottom: 10px;">
                        <input type="text" value="${point}" style="width: 100%; margin-bottom: 5px;">
                        <textarea placeholder="Description (optionnelle)" rows="2" style="width: 100%;"></textarea>
                    </div>
                `;
                container.appendChild(div);
            });
            
            setupDragAndDrop();
            fermerTemplates();
        }

        // G√©n√©ration automatique bas√©e sur les P.P.P.
        function genererOrdreJourAuto() {
            const pppChecked = Array.from(document.querySelectorAll('input[name="ppp"]:checked'))
                .map(cb => cb.value);
            
            if (pppChecked.length === 0) {
                alert('Veuillez s√©lectionner au moins une th√©matique P.P.P. pour g√©n√©rer l\'ordre du jour automatiquement.');
                return;
            }

            const container = document.getElementById('ordreJourList');
            container.innerHTML = '';
            
            // Points fixes
            const pointsFixes = ['Ouverture et tour de table', 'Suivi des actions pr√©c√©dentes'];
            
            pointsFixes.forEach(point => {
                ordreJourCounter++;
                const div = document.createElement('div');
                div.className = 'ordre-jour-item';
                div.draggable = true;
                div.innerHTML = `
                    <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                    <div style="margin-bottom: 10px;">
                        <input type="text" value="${point}" style="width: 100%; margin-bottom: 5px;">
                        <textarea placeholder="Description (optionnelle)" rows="2" style="width: 100%;"></textarea>
                    </div>
                `;
                container.appendChild(div);
            });

            // Points bas√©s sur les P.P.P.
            pppChecked.forEach(ppp => {
                ordreJourCounter++;
                const div = document.createElement('div');
                div.className = 'ordre-jour-item';
                div.draggable = true;
                div.innerHTML = `
                    <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                    <div style="margin-bottom: 10px;">
                        <input type="text" value="P.P.P. - ${ppp}" style="width: 100%; margin-bottom: 5px;">
                        <textarea placeholder="D√©tails et √©changes sur ${ppp.toLowerCase()}" rows="2" style="width: 100%;"></textarea>
                    </div>
                `;
                container.appendChild(div);
            });

            // Point de cl√¥ture
            ordreJourCounter++;
            const divCloture = document.createElement('div');
            divCloture.className = 'ordre-jour-item';
            divCloture.draggable = true;
            divCloture.innerHTML = `
                <button type="button" class="delete-item" onclick="supprimerPoint(this)">üóëÔ∏è</button>
                <div style="margin-bottom: 10px;">
                    <input type="text" value="Synth√®se et actions √† retenir" style="width: 100%; margin-bottom: 5px;">
                    <textarea placeholder="R√©capitulatif des d√©cisions et actions" rows="2" style="width: 100%;"></textarea>
                </div>
            `;
            container.appendChild(divCloture);
            
            setupDragAndDrop();
        }

        // Drag & Drop
        function setupDragAndDrop() {
            const items = document.querySelectorAll('.ordre-jour-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedHTML = e.dataTransfer.getData('text/html');
            this.insertAdjacentHTML('beforebegin', draggedHTML);
            const dragged = document.querySelector('.dragging');
            if (dragged) dragged.remove();
            setupDragAndDrop();
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        // G√©n√©ration de synth√®se IA
        function genererSyntheseIA() {
            const sites = Array.from(document.querySelectorAll('input[name="sites"]:checked')).map(cb => cb.value);
            const presents = Array.from(document.querySelectorAll('input[name="consultants"]:checked')).map(cb => cb.value);
            const ppp = Array.from(document.querySelectorAll('input[name="ppp"]:checked')).map(cb => cb.value);
            const ordreJour = Array.from(document.querySelectorAll('.ordre-jour-item input[type="text"]')).map(input => input.value).filter(val => val);

            let synthese = "ü§ñ Synth√®se g√©n√©r√©e automatiquement :\n\n";
            
            if (sites.length > 0) {
                synthese += `üìç Cette r√©union a concern√© ${sites.length} site(s) : ${sites.join(', ')}.\n\n`;
            }
            
            if (presents.length > 0) {
                synthese += `üë• ${presents.length} consultant(s) √©taient pr√©sents pour √©changer sur les pratiques professionnelles.\n\n`;
            }
            
            if (ppp.length > 0) {
                synthese += `üìä Les th√©matiques P.P.P. abord√©es :\n`;
                ppp.forEach(theme => {
                    synthese += `‚Ä¢ ${theme}\n`;
                });
                synthese += '\n';
            }
            
            if (ordreJour.length > 0) {
                synthese += `üìù Points principaux trait√©s :\n`;
                ordreJour.slice(0, 3).forEach(point => {
                    synthese += `‚Ä¢ ${point}\n`;
                });
                synthese += '\n';
            }
            
            synthese += `üéØ Points cl√©s de la r√©union :\n`;
            synthese += `‚Ä¢ Partage d'exp√©riences constructif entre les participants\n`;
            synthese += `‚Ä¢ Identification de bonnes pratiques √† g√©n√©raliser\n`;
            synthese += `‚Ä¢ Actions concr√®tes d√©finies pour la suite\n\n`;
            
            synthese += `‚ùì Questions/R√©ponses :\n`;
            synthese += `‚Ä¢ Les √©changes ont permis de clarifier certains points\n`;
            synthese += `‚Ä¢ Les retours d'exp√©rience ont enrichi les pratiques\n\n`;
            
            synthese += `üìã Observations :\n`;
            synthese += `‚Ä¢ Bonne participation de l'√©quipe\n`;
            synthese += `‚Ä¢ Dynamique collaborative positive\n`;
            synthese += `‚Ä¢ Engagement des consultants dans la d√©marche`;

            document.getElementById('synthese').value = synthese;
            updateCharCount('synthese', 1000);
        }

        // Compteur de caract√®res
        function updateCharCount(textareaId, maxLength) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(textareaId + 'Count');
            const currentLength = textarea.value.length;
            
            counter.textContent = `${currentLength}/${maxLength} caract√®res`;
            
            if (currentLength > maxLength * 0.9) {
                counter.className = 'char-counter danger';
            } else if (currentLength > maxLength * 0.7) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
            
            updateProgress();
        }

        // Sauvegarde automatique
        function setupAutoSave() {
            setInterval(() => {
                // Auto-save silencieux toutes les 30 secondes
                if (document.getElementById('date').value) {
                    showSaveStatus();
                }
            }, 30000);
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 2000);
        }

        // Fonctions de sauvegarde/chargement R√âELLES
        function sauvegarder() {
            const nomSauvegarde = prompt('Nom de la sauvegarde :', `R√©union_${new Date().toISOString().split('T')[0]}`);
            if (!nomSauvegarde) return;
            
            const formData = collectFormData();
            formData.ordreJourHTML = document.getElementById('ordreJourList').innerHTML;
            
            const sauvegarde = {
                nom: nomSauvegarde,
                date: new Date().toISOString(),
                data: formData
            };
            
            let sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            sauvegardes.push(sauvegarde);
            localStorage.setItem('sauvegardes_vs2', JSON.stringify(sauvegardes));
            
            showSaveStatus();
            alert(`‚úÖ Formulaire "${nomSauvegarde}" sauvegard√© avec succ√®s !`);
        }

        function charger() {
            const sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            const modalContent = document.querySelector('#chargementModal .modal-content');
            
            if (sauvegardes.length === 0) {
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3>üìÇ Charger un formulaire</h3>
                        <span class="close" onclick="fermerChargement()">&times;</span>
                    </div>
                    <p>Aucune sauvegarde trouv√©e. Cr√©ez d'abord une sauvegarde en remplissant le formulaire et en cliquant sur "üíæ Sauvegarder".</p>
                `;
            } else {
                let html = `
                    <div class="modal-header">
                        <h3>üìÇ Charger un formulaire (${sauvegardes.length} sauvegarde(s))</h3>
                        <span class="close" onclick="fermerChargement()">&times;</span>
                    </div>
                `;
                
                sauvegardes.reverse().forEach((save, index) => {
                    const realIndex = sauvegardes.length - 1 - index;
                    const dateFormatee = new Date(save.date).toLocaleString('fr-FR');
                    html += `
                        <div style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #f8f9fa;">
                            <button class="btn btn-primary" onclick="chargerFormulaire(${realIndex})" style="margin-bottom: 5px; width: 100%;">${save.nom}</button>
                            <p style="font-size: 12px; color: #666; margin: 0;">Sauvegard√© le: ${dateFormatee}</p>
                            <button class="btn" onclick="supprimerSauvegarde(${realIndex})" style="background: #e74c3c; color: white; font-size: 11px; padding: 3px 8px; margin-top: 5px;">üóëÔ∏è Supprimer</button>
                        </div>
                    `;
                });
                
                modalContent.innerHTML = html;
            }
            
            document.getElementById('chargementModal').style.display = 'block';
        }

        function fermerChargement() {
            document.getElementById('chargementModal').style.display = 'none';
        }

        function chargerFormulaire(index) {
            const sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            const sauvegarde = sauvegardes[index];
            
            if (!sauvegarde) {
                alert('Erreur : Sauvegarde introuvable');
                return;
            }
            
            const data = sauvegarde.data;
            
            // Charger les champs de base
            document.getElementById('date').value = data.date || '';
            
            // Charger les horaires (nouveau syst√®me)
            if (data.heureDebut && data.heureFin) {
                document.getElementById('heureDebut').value = data.heureDebut;
                document.getElementById('heureFin').value = data.heureFin;
                updateHoraires();
            } else if (data.horaires) {
                // Compatibilit√© avec ancien syst√®me
                document.getElementById('horaires').value = data.horaires;
            }
            
            document.getElementById('animateur').value = data.animateur || '';
            document.getElementById('modalite').value = data.modalite || '';
            document.getElementById('intervenantsSolerys').value = data.intervenantsSolerys || '';
            document.getElementById('intervenantsExterieurs').value = data.intervenantsExterieurs || '';
            document.getElementById('synthese').value = data.synthese || '';
            
            // Charger les sites
            document.querySelectorAll('input[name="sites"]').forEach(cb => {
                cb.checked = data.sites && data.sites.includes(cb.value);
            });
            
            // Charger les consultants pr√©sents
            document.querySelectorAll('input[name="consultants"]').forEach(cb => {
                cb.checked = data.presents && data.presents.includes(cb.value);
            });
            
            // Charger les consultants absents
            document.querySelectorAll('input[name="absents"]').forEach(cb => {
                cb.checked = data.absentsChecked && data.absentsChecked.includes(cb.value);
            });
            
            // Charger les P.P.P.
            document.querySelectorAll('input[name="ppp"]').forEach(cb => {
                cb.checked = data.ppp && data.ppp.includes(cb.value);
            });
            
            // Charger l'ordre du jour
            if (data.ordreJourHTML) {
                document.getElementById('ordreJourList').innerHTML = data.ordreJourHTML;
                setupDragAndDrop();
            }
            
            // Mettre √† jour les champs calcul√©s
            updateReference();
            updateAbsents();
            updateProgress();
            updateCharCount('synthese', 1000);
            
            fermerChargement();
            alert(`‚úÖ Formulaire "${sauvegarde.nom}" charg√© avec succ√®s !`);
        }

        function supprimerSauvegarde(index) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette sauvegarde ?')) return;
            
            let sauvegardes = JSON.parse(localStorage.getItem('sauvegardes_vs2') || '[]');
            sauvegardes.splice(index, 1);
            localStorage.setItem('sauvegardes_vs2', JSON.stringify(sauvegardes));
            
            // Recharger la liste
            charger();
        }

        // Finalisation
        function finaliserCompteRendu() {
            const date = document.getElementById('date').value;
            const animateur = document.getElementById('animateur').value;
            const modalite = document.getElementById('modalite').value;
            const heureDebut = document.getElementById('heureDebut').value;
            const heureFin = document.getElementById('heureFin').value;
            
            if (!date || !animateur || !modalite || !heureDebut || !heureFin) {
                alert('‚ö†Ô∏è Veuillez remplir les champs obligatoires :\n- Date\n- Horaires (d√©but et fin)\n- Animateur\n- Modalit√©');
                return;
            }
            
            const confirmer = confirm('‚úì Compte-rendu finalis√© avec succ√®s !\n\nüìÑ Souhaitez-vous g√©n√©rer le PDF maintenant ?');
            if (confirmer) {
                genererPDF();
            }
        }

        // G√©n√©ration PDF
        function genererPDF() {
            const verifier = confirm(`üìã V√©rifier et valider le compte-rendu

‚ö†Ô∏è Avant de g√©n√©rer le PDF, assurez-vous que :
- Toutes les informations sont correctes
- La synth√®se est compl√®te  
- Les participants sont bien list√©s
- L'ordre du jour est finalis√©

Voulez-vous continuer la g√©n√©ration du PDF ?`);
            
            if (!verifier) {
                return;
            }

            try {
                const formData = collectFormData();
                const pdfContent = generatePDFContent(formData);
                
                document.getElementById('pdfContent').innerHTML = pdfContent;
                document.getElementById('pdfModal').style.display = 'block';
                
            } catch (error) {
                alert('Erreur lors de la g√©n√©ration du PDF : ' + error.message);
            }
        }

        function collectFormData() {
            return {
                reference: document.getElementById('reference').value || 'N/A',
                date: document.getElementById('date').value || 'N/A',
                heureDebut: document.getElementById('heureDebut').value || '14:00',
                heureFin: document.getElementById('heureFin').value || '16:00',
                horaires: document.getElementById('horaires').value || 'N/A',
                animateur: document.getElementById('animateur').value || 'N/A',
                modalite: document.getElementById('modalite').value || 'N/A',
                sites: Array.from(document.querySelectorAll('input[name="sites"]:checked')).map(cb => cb.value),
                presents: Array.from(document.querySelectorAll('input[name="consultants"]:checked')).map(cb => cb.value),
                absentsChecked: Array.from(document.querySelectorAll('input[name="absents"]:checked')).map(cb => cb.value),
                absents: Array.from(document.querySelectorAll('input[name="absents"]:checked')).map(cb => cb.value).join(', ') || 'Aucun',
                intervenantsSolerys: document.getElementById('intervenantsSolerys').value || 'N/A',
                intervenantsExterieurs: document.getElementById('intervenantsExterieurs').value || 'N/A',
                ppp: Array.from(document.querySelectorAll('input[name="ppp"]:checked')).map(cb => cb.value),
                ordreJour: Array.from(document.querySelectorAll('.ordre-jour-item')).map(item => {
                    const titre = item.querySelector('input[type="text"]')?.value || '';
                    const description = item.querySelector('textarea')?.value || '';
                    return { titre, description };
                }).filter(item => item.titre),
                synthese: document.getElementById('synthese').value || 'N/A'
            };
        }

        function generatePDFContent(data) {
            return `
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.4; margin: 0; }
                    .pdf-header { background: #27ae60; color: white; padding: 15px; margin: -20px -20px 20px -20px; text-align: center; }
                    .section { margin-bottom: 20px; page-break-inside: avoid; }
                    .section-title { color: #27ae60; font-size: 16px; font-weight: bold; border-bottom: 1px solid #27ae60; padding-bottom: 5px; margin-bottom: 10px; }
                    .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px; }
                    .info-item { background: #f8f9fa; padding: 8px; border-radius: 4px; }
                    .info-label { font-weight: bold; color: #2c3e50; }
                    .list-item { margin-bottom: 5px; padding-left: 15px; }
                    .ordre-jour-item { background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 4px; }
                    .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }
                    @media print { 
                        body { margin: 0; }
                        .pdf-header { background: #27ae60 !important; }
                        .no-print { display: none; }
                    }
                </style>
                
                <div class="pdf-header">
                    <h1>Compte-rendu de R√©union d'√©quipe VS2</h1>
                    <p>Partages des Pratiques Professionnelles - Solerys</p>
                    <button onclick="window.print()" class="no-print" style="background: white; color: #27ae60; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px;">üñ®Ô∏è Imprimer / Sauvegarder en PDF</button>
                </div>

                <div class="section">
                    <div class="section-title">üìã Informations g√©n√©rales</div>
                    <div class="info-grid">
                        <div class="info-item"><span class="info-label">R√©f√©rence:</span> ${data.reference}</div>
                        <div class="info-item"><span class="info-label">Date:</span> ${data.date}</div>
                        <div class="info-item"><span class="info-label">Horaires:</span> ${data.horaires}</div>
                        <div class="info-item"><span class="info-label">Animateur:</span> ${data.animateur}</div>
                        <div class="info-item"><span class="info-label">Modalit√©:</span> ${data.modalite}</div>
                    </div>
                </div>

                ${data.sites.length > 0 ? `
                <div class="section">
                    <div class="section-title">üè¢ Sites concern√©s</div>
                    ${data.sites.map(site => `<div class="list-item">‚Ä¢ ${site}</div>`).join('')}
                </div>
                ` : ''}

                <div class="section">
                    <div class="section-title">üë• Participants</div>
                    ${data.presents.length > 0 ? `
                    <div style="margin-bottom: 15px;">
                        <strong>Consultants pr√©sents:</strong><br>
                        ${data.presents.map(p => `<div class="list-item">‚Ä¢ ${p}</div>`).join('')}
                    </div>
                    ` : ''}
                    <div>
                        <strong>Consultants absents:</strong> ${data.absents}
                    </div>
                </div>

                ${data.intervenantsSolerys !== 'N/A' || data.intervenantsExterieurs !== 'N/A' ? `
                <div class="section">
                    <div class="section-title">üéØ Intervenants</div>
                    ${data.intervenantsSolerys !== 'N/A' ? `<div><strong>Solerys:</strong> ${data.intervenantsSolerys}</div>` : ''}
                    ${data.intervenantsExterieurs !== 'N/A' ? `<div><strong>Ext√©rieurs:</strong> ${data.intervenantsExterieurs}</div>` : ''}
                </div>
                ` : ''}

                ${data.ppp.length > 0 ? `
                <div class="section">
                    <div class="section-title">üìä P.P.P. abord√©es</div>
                    ${data.ppp.map(ppp => `<div class="list-item">‚Ä¢ ${ppp}</div>`).join('')}
                </div>
                ` : ''}

                ${data.ordreJour.length > 0 ? `
                <div class="section">
                    <div class="section-title">üìù Ordre du jour</div>
                    ${data.ordreJour.map((item, index) => `
                        <div class="ordre-jour-item">
                            <strong>${index + 1}. ${item.titre}</strong>
                            ${item.description ? `<div style="margin-top: 5px; font-style: italic;">${item.description}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                ${data.synthese !== 'N/A' ? `
                <div class="section">
                    <div class="section-title">üìÑ Synth√®se</div>
                    <div style="white-space: pre-line; background: #f8f9fa; padding: 15px; border-radius: 4px;">${data.synthese}</div>
                </div>
                ` : ''}

                <div class="footer">
                    <strong>SOLERYS - OASYS & Cie</strong><br>
                    www.solerys.fr<br>
                    Document g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
                </div>
            `;
        }

        function imprimerPDF() {
            try {
                const printWindow = window.open('', '_blank');
                if (printWindow) {
                    printWindow.document.write(document.getElementById('pdfContent').innerHTML);
                    printWindow.document.close();
                    printWindow.print();
                } else {
                    alert('Veuillez autoriser les fen√™tres popup pour imprimer le document.');
                }
            } catch (error) {
                alert('Erreur lors de l\'impression : ' + error.message);
            }
        }

        function telechargerPDF() {
            try {
                const content = document.getElementById('pdfContent').innerHTML;
                const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
                const filename = `Compte-rendu-VS2-${date}.html`;
                
                const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Compte-rendu VS2</title></head><body>${content}</body></html>`], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('üìÑ Fichier t√©l√©charg√© ! Ouvrez-le dans votre navigateur et utilisez Ctrl+P pour l\'imprimer en PDF.');
            } catch (error) {
                alert('Erreur lors du t√©l√©chargement : ' + error.message);
            }
        }

        function fermerPDF() {
            document.getElementById('pdfModal').style.display = 'none';
        }

        // Event listeners
        document.getElementById('date').addEventListener('change', updateReference);
        document.getElementById('heureDebut').addEventListener('change', updateHoraires);
        document.getElementById('heureFin').addEventListener('change', updateHoraires);
        document.addEventListener('input', updateProgress);

        // Fermeture des modals en cliquant √† l'ext√©rieur
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            if (event.target === document.getElementById('pdfModal')) {
                fermerPDF();
            }
        });
    </script>
</body>
</html>
